# subnets-module
GCP Terraform subnets module Repo

ì´ ëª¨ë“ˆì€ GCPì—ì„œ ì„œë¸Œë„¤íŠ¸ì›Œí¬(Subnetwork)ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•œ ëª¨ë“ˆì…ë‹ˆë‹¤. <br>
ì‚¬ìš©ì ì •ì˜ ì„œë¸Œë„¤íŠ¸ì›Œí¬ë¥¼ ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

<br>

## ğŸ“‘ **ëª©ì°¨**
1. [ëª¨ë“ˆ íŠ¹ì§•](#ëª¨ë“ˆ-íŠ¹ì§•)
2. [ì‚¬ìš© ë°©ë²•](#ì‚¬ìš©-ë°©ë²•)
    1. [ì‚¬ì „ ì¤€ë¹„](#1-ì‚¬ì „-ì¤€ë¹„)
    2. [ì…ë ¥ ë³€ìˆ˜](#2-ì…ë ¥-ë³€ìˆ˜)
    3. [ëª¨ë“ˆ í˜¸ì¶œ ì˜ˆì‹œ](#3-ëª¨ë“ˆ-í˜¸ì¶œ-ì˜ˆì‹œ)
    4. [ì¶œë ¥ê°’ (Outputs)](#4-ì¶œë ¥ê°’-outputs)
    5. [ì§€ì› ë²„ì „](#5-ì§€ì›-ë²„ì „)
    6. [ëª¨ë“ˆ ê°œë°œ ë° ê´€ë¦¬](#6-ëª¨ë“ˆ-ê°œë°œ-ë°-ê´€ë¦¬)
3. [í…ŒìŠ¤íŠ¸](#terratestë¥¼-ì´ìš©í•œ-í…ŒìŠ¤íŠ¸)
4. [ì£¼ìš” ë²„ì „ ê´€ë¦¬](#ì£¼ìš”-ë²„ì „-ê´€ë¦¬)
5. [ê¸°ì—¬](#ê¸°ì—¬-contributing)
6. [ë¼ì´ì„ ìŠ¤](#ë¼ì´ì„ ìŠ¤-license)

---

## ëª¨ë“ˆ íŠ¹ì§•

- ì‚¬ìš©ì ì •ì˜ ì„œë¸Œë„¤íŠ¸ì›Œí¬ ìƒì„±.
- VPC ë„¤íŠ¸ì›Œí¬ì™€ ì—°ê²°ëœ ì„œë¸Œë„¤íŠ¸ì›Œí¬ ì„¤ì • ì§€ì›.
- Google Private Access í™œì„±í™” ì˜µì…˜ ì œê³µ.
- Kubernetes Pod ë° Serviceë¥¼ ìœ„í•œ Secondary IP CIDR ë²”ìœ„ êµ¬ì„±.
- íë¦„ ë¡œê·¸(Flow Log) ì„¤ì • ê°€ëŠ¥
    - ë¡œê·¸ ì§‘ê³„ ê°„ê²©(Aggregation Interval)
    - ë¡œê·¸ ìƒ˜í”Œë§ ë¹„ìœ¨(Sampling Rate)
    - ë©”íƒ€ë°ì´í„° í¬í•¨ ì—¬ë¶€ ì„¤ì •

---

## ì‚¬ìš© ë°©ë²•

### 1. ì‚¬ì „ ì¤€ë¹„

ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”:
1. Google Cloud í”„ë¡œì íŠ¸ ì¤€ë¹„.
2. ì ì ˆí•œ IAM ê¶Œí•œ í•„ìš”: roles/compute.networkAdmin (ì„œë¸Œë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ ê¶Œí•œ í•„ìˆ˜).
3. VPC ë„¤íŠ¸ì›Œí¬ë¥¼ ë™ì‹œì— ìƒì„±í•˜ê±°ë‚˜, ì´ë¯¸ ìƒì„±í•´ë†“ì•„ì•¼ í•¨.

<br>

### 2. ì…ë ¥ ë³€ìˆ˜

#### í•„ìˆ˜ ì˜µì…˜

| ë³€ìˆ˜ëª…    | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                   |
|-----------|--------|-----------|--------|------------------------|
| `name`   | string | âœ…        | ì—†ìŒ   | ì„œë¸Œë„¤íŠ¸ì›Œí¬ ì´ë¦„       |
| `network`| string | âœ…        | ì—†ìŒ   | ì„œë¸Œë„¤íŠ¸ì›Œí¬ê°€ ì†í•œ VPC |

<br>

#### ì„ íƒì  ì˜µì…˜
##### ê¸°ë³¸ ì„¤ì •
| ë³€ìˆ˜ëª…                  | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                                |
|-------------------------|--------|-----------|--------|-------------------------------------|
| `description`          | string | âŒ        | `null` | ì„œë¸Œë„¤íŠ¸ì›Œí¬ ì„¤ëª…                   |
| `ip_cidr_range`        | string | âœ…        | ì—†ìŒ   | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ IP CIDR ë²”ìœ„         |
| `reserved_internal_range` | string | âŒ      | `null` | ì˜ˆì•½ëœ ë‚´ë¶€ ë²”ìœ„ ID                |
| `purpose`              | string | âŒ        | `PRIVATE` | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ ëª©ì  (PRIVATE ë“±)   |
| `role`                 | string | âŒ        | `null` | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ ì—­í•  (ACTIVE/BACKUP) |
| `region`               | string | âœ…        | ì—†ìŒ   | ì„œë¸Œë„¤íŠ¸ì›Œí¬ê°€ ìƒì„±ë  GCP ë¦¬ì „      |

<br> 

##### IPv6 ê´€ë ¨ ì„¤ì •
| ë³€ìˆ˜ëª…                  | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’     | ì„¤ëª…                                  |
|-------------------------|--------|-----------|------------|---------------------------------------|
| `stack_type`           | string | âŒ        | `IPV4_ONLY`| ì„œë¸Œë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ ìœ í˜• (IPV4_ONLY ë“±) |
| `ipv6_access_type`     | string | âŒ        | `null`     | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ IPv6 ì ‘ê·¼ ìœ í˜•         |
| `external_ipv6_prefix` | string | âŒ        | `null`     | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ ì™¸ë¶€ IPv6 ì£¼ì†Œ ë²”ìœ„    |


<br>

##### Google API ì ‘ê·¼ ì„¤ì •
| ë³€ìˆ˜ëª…                    | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                                  |
|---------------------------|--------|-----------|--------|---------------------------------------|
| `private_ip_google_access` | bool  | âŒ        | `false`| Private Google Access í™œì„±í™” ì—¬ë¶€     |
| `private_ipv6_google_access` | string | âŒ      | `null` | Private IPv6 Google Access ìœ í˜•       |

<br>

##### Secondary IP Range ì„¤ì •
| ë³€ìˆ˜ëª…                   | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                                |
|--------------------------|--------|-----------|--------|-------------------------------------|
| `secondary_ip_ranges`   | list   | âŒ        | `[]`   | Secondary IP CIDR ë²”ìœ„ êµ¬ì„± ëª©ë¡     |


<br>

##### ë¡œê·¸ ì„¤ì •
| ë³€ìˆ˜ëª…          | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                           |
|-----------------|--------|-----------|--------|--------------------------------|
| `log_config`   | object | âŒ        | `null` | VPC í”Œë¡œìš° ë¡œê¹… êµ¬ì„±           |

<br>

#### ê¸°íƒ€ ì„¤ì •
| ë³€ìˆ˜ëª…                          | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’ | ì„¤ëª…                                    |
|---------------------------------|--------|-----------|--------|-----------------------------------------|
| `send_secondary_ip_range_if_empty` | bool | âŒ        | `false`| Secondary IP Range ì œê±° ì‹œ ë™ì‘          |

<br>

#### Timeout ì„¤ì •
| ë³€ìˆ˜ëª…            | íƒ€ì…   | í•„ìˆ˜ ì—¬ë¶€ | ê¸°ë³¸ê°’  | ì„¤ëª…                         |
|-------------------|--------|-----------|---------|------------------------------|
| `timeout_create` | string | âŒ        | `"20m"`| ë¦¬ì†ŒìŠ¤ ìƒì„± ì œí•œ ì‹œê°„         |
| `timeout_update` | string | âŒ        | `"20m"`| ë¦¬ì†ŒìŠ¤ ì—…ë°ì´íŠ¸ ì œí•œ ì‹œê°„     |
| `timeout_delete` | string | âŒ        | `"20m"`| ë¦¬ì†ŒìŠ¤ ì‚­ì œ ì œí•œ ì‹œê°„         |

<br>

### 3. ëª¨ë“ˆ í˜¸ì¶œ ì˜ˆì‹œ

```hcl
module "subnetwork" {
  source = "git::https://github.com/GCP-Terraform-Module-steamedEggMaster/subnets-module.git?ref=v1.0.0"

  name                    = "custom-subnet"
  region                  = "asia-northeast3"
  network                 = "projects/my-project/global/networks/my-vpc"
  ip_cidr_range           = "10.0.0.0/16"
  private_ip_google_access = true

  secondary_ip_ranges = [
    {
      range_name    = "secondary-1"
      ip_cidr_range = "10.1.0.0/24"
    },
    {
      range_name    = "secondary-2"
      ip_cidr_range = "10.2.0.0/24"
    }
  ]

  log_config = {
    aggregation_interval = "INTERVAL_10_MIN"
    flow_sampling        = 0.7
    metadata             = "INCLUDE_ALL_METADATA"
  }
}
```

<br>

### 4. ì¶œë ¥ê°’ (Outputs)

| ì¶œë ¥ëª…                     | ì„¤ëª…                                          |
|----------------------------|-----------------------------------------------|
| `id`                       | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ ê³ ìœ  ID                        |
| `name`                     | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ ì´ë¦„                           |
| `self_link`                | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ URI                           |
| `gateway_address`          | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ ê¸°ë³¸ ê²Œì´íŠ¸ì›¨ì´ ì£¼ì†Œ           |
| `region`                   | ì„œë¸Œë„¤íŠ¸ì›Œí¬ê°€ ìƒì„±ëœ ë¦¬ì „                    |
| `ipv6_cidr_range`          | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ ë‚´ë¶€ IPv6 ë²”ìœ„                 |
| `network`                  | ì„œë¸Œë„¤íŠ¸ì›Œí¬ê°€ ì†í•œ VPC ë„¤íŠ¸ì›Œí¬ì˜ ì´ë¦„       |
| `purpose`                  | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ ëª©ì  (ì˜ˆ: PRIVATE ë“±)          |
| `stack_type`               | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ ìŠ¤íƒ ìœ í˜• (ì˜ˆ: IPV4_ONLY ë“±)   |
| `private_ip_google_access` | Google API ë° ì„œë¹„ìŠ¤ì— ëŒ€í•œ Private IP ì ‘ê·¼ í™œì„±í™” ì—¬ë¶€ |
| `private_ipv6_google_access` | ì„œë¸Œë„¤íŠ¸ì›Œí¬ì˜ Private IPv6 Google Access ìœ í˜• |


<br>

### 5. ì§€ì› ë²„ì „

#### a.  Terraform ë²„ì „
| ë²„ì „ ë²”ìœ„ | ì„¤ëª…                              |
|-----------|-----------------------------------|
| `1.10.3`   | ìµœì‹  ë²„ì „, ì§€ì› ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ                  |

#### b. Google Provider ë²„ì „
| ë²„ì „ ë²”ìœ„ | ì„¤ëª…                              |
|-----------|-----------------------------------|
| `~> 4.0`  | ìµœì†Œ ì§€ì› ë²„ì „                   |

<br>

### 6. ëª¨ë“ˆ ê°œë°œ ë° ê´€ë¦¬

- **ì €ì¥ì†Œ êµ¬ì¡°**:
  ```
  subnets-module/
    â”œâ”€â”€ .github/workflows/  # github actions ìë™í™” í…ŒìŠ¤íŠ¸
    â”œâ”€â”€ examples/           # í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë£¨íŠ¸ ëª¨ë“ˆ ëª¨ìŒ ë””ë ‰í„°ë¦¬
    â”œâ”€â”€ test/               # í…ŒìŠ¤íŠ¸ êµ¬ì„± ë””ë ‰í„°ë¦¬
    â”œâ”€â”€ main.tf             # ëª¨ë“ˆì˜ í•µì‹¬ êµ¬í˜„
    â”œâ”€â”€ variables.tf        # ì…ë ¥ ë³€ìˆ˜ ì •ì˜
    â”œâ”€â”€ outputs.tf          # ì¶œë ¥ ì •ì˜
    â”œâ”€â”€ README.md           # ë¬¸ì„œí™” íŒŒì¼
  ```

<br>

---

### Terratestë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸
ì´ ëª¨ë“ˆì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì œê³µëœ Go ê¸°ë°˜ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. ì•„ë˜ë¥¼ í™•ì¸í•˜ì„¸ìš”:

1. Terraform ë° Go ì„¤ì¹˜.
2. í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •.
3. í…ŒìŠ¤íŠ¸ ì‹¤í–‰:
```bash
go test -v ./test
```

<br>

## ì£¼ìš” ë²„ì „ ê´€ë¦¬
ì´ ëª¨ë“ˆì€ [Semantic Versioning](https://semver.org/)ì„ ë”°ë¦…ë‹ˆë‹¤.  
ì•ˆì •ëœ ë²„ì „ì„ ì‚¬ìš©í•˜ë ¤ë©´ `?ref=<version>`ì„ í™œìš©í•˜ì„¸ìš”:

```hcl
source = "git::https://github.com/GCP-Terraform-Module-steamedEggMaster/subnets-module.git?ref=v1.0.0"
```

### Module ref ë²„ì „
| Major | Minor | Patch |
|-----------|-----------|----------|
| `1.0.0`   |    |   |

<br>

## ê¸°ì—¬ (Contributing)
ê¸°ì—¬ë¥¼ í™˜ì˜í•©ë‹ˆë‹¤! ë²„ê·¸ ì œë³´ ë° ê¸°ëŠ¥ ìš”ì²­ì€ GitHub Issuesë¥¼ í†µí•´ ì œì¶œí•´ì£¼ì„¸ìš”.

<br>

## ë¼ì´ì„ ìŠ¤ (License)
[MIT License](LICENSE)